---
layout: page
title: React-Query
parent: ë¦¬ì•¡íŠ¸
nav_order: 1
has_children: false
permalink: /react/react-query
---

# React-Query

> ì´ í¬ìŠ¤íŒ…ì€ ê¸°ë³¸ì ìœ¼ë¡œ [React-Query Docs](https://react-query.tanstack.com/)ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ëë‹¤.

ê³µì‹ë¬¸ì„œì— ë”°ë¥´ë©´ React-QueryëŠ” React ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ fetching(íŒ¨ì¹˜), caching(ìºì‹±), synchronizing(ë™ê¸°í™”) and updating server state(ì„œë²„ìƒíƒœ ì—…ë°ì´íŠ¸)ë¥¼ ì‰½ê²Œ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¼ê³  ì†Œê°œë˜ì–´ ìˆë‹¤.  
í•œë§ˆë””ë¡œ ë§í•˜ë©´, ë¹„ë™ê¸° ë¡œì§ê³¼ ì„œë²„ ìƒíƒœë¥¼ ì‰½ê²Œ ë‹¤ë£¨ê²Œ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.

## ë§Œë“¤ì–´ì§„ ë™ê¸°

- Reactì•± ìì²´ê°€ ë°ì´í„°ë¥¼ íŒ¨ì¹­í•´ì˜¤ê±°ë‚˜ ì—…ë°ì´íŠ¸í•˜ëŠ” ì˜µì…˜ì„ ì œê³µí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê°œë°œìë“¤ì€ ê°ì ê³ ìœ í•œ ë°©ì‹ìœ¼ë¡œ ë¡œì§ì„ êµ¬ì¶•í•´ì•¼í–ˆë‹¤.
- ëŒ€ë¶€ë¶„ì˜ ê¸°ì¡´ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ”(ì˜ˆë¥¼ ë“¤ì–´, `Redux`) í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ì‘ì—…ì—ëŠ” ì í•©í•˜ì§€ë§Œ, ì„œë²„ìƒíƒœë‚˜ ë¹„ë™ê¸° ì‘ì—…ì—ëŠ” ì í•©í•˜ì§€ ì•Šë‹¤. `Client state`ì™€ `Server state`ëŠ” ì™„ì „íˆ ë‹¤ë¥´ê¸° ë•Œë¬¸ì´ë‹¤.
  - **Client state**
    - ì–¸ì–´, ui, í¼ ì…ë ¥ ìƒíƒœ ë“± í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´, ì†Œìœ í•˜ëŠ” ë°ì´í„°ë¥¼ ë§í•œë‹¤. ë•Œë¬¸ì— ë™ê¸°ì ì¸ ìƒíƒœë¥¼ ê°–ëŠ”ë‹¤.
  - **Server state**
    - ì„œë²„ë¡œ ë¶€í„° ë¶ˆëŸ¬ì˜¤ëŠ” ë°ì´í„°ë¥¼ ë§í•œë‹¤. í´ë¼ì´ì–¸íŠ¸ê°€ ì œì–´, ì†Œìœ í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì„œë²„ë¡œ ë¶€í„° íŠ¹ì • ì‹œì ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì €ì¥í•˜ì—¬ ì‚¬ìš©í•œë‹¤. ë•Œë¬¸ì— `ë¹„ë™ê¸°ì ì¸` ìƒíƒœë¥¼ ê°–ëŠ”ë‹¤.
    - í•­ìƒ ìµœì‹  ìƒíƒœì„ì„ ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ëª…ì‹œì ìœ¼ë¡œ fetchingì„ ìˆ˜í–‰í•´ì•¼ë§Œ ìµœì‹  ë°ì´í„°ë¡œ ì „í™˜ëœë‹¤.

## react-query ìƒíƒœ

### 1\. Queryë“¤ì€ 4ê°œì˜ ìƒíƒœë¥¼ ê°€ì§„ë‹¤.

- **fresh**: ìƒˆë¡­ê²Œ ì¶”ê°€ëœ ì¿¼ë¦¬ & ë§Œë£Œë˜ì§€ ì•Šì€ ì¿¼ë¦¬. -> ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸, ì—…ë°ì´íŠ¸ë˜ì–´ë„ ë°ì´í„° ì¬ìš”ì²­ âŒ
- **stale**: ì¸ìŠ¤í„´ìŠ¤ê°€ ì¡´ì¬í•˜ì§€ë§Œ ì´ë¯¸ íŒ¨ì¹­ì´ ì™„ë£Œëœ ì¿¼ë¦¬. -> ì»´í¬ë„ŒíŠ¸ê°€ ë§ˆìš´íŠ¸, ì—…ë°ì´íŠ¸ë˜ë©´ ë°ì´í„° ì¬ìš”ì²­(ë¦¬íŒ¨ì¹­/ refetching) â­•ï¸
  - íŠ¹ì • ì¿¼ë¦¬ê°€ `stale`ëœ ìƒíƒœì—ì„œ ê°™ì€ ì¿¼ë¦¬ ë§ˆìš´íŠ¸ë¥¼ ì‹œë„í•˜ë©´ ìºì‹±ëœ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë©´ì„œ `ë¦¬íŒ¨ì¹­(refetching)`ì„ ì‹œë„í•œë‹¤.
- **fetching**: ìš”ì²­ì„ ìˆ˜í–‰í•˜ëŠ” ì¤‘ì¸ ì¿¼ë¦¬
- **inactive**: `active` ì¸ìŠ¤í„´ìŠ¤ê°€ í•˜ë‚˜ë„ ì—†ëŠ” ì¿¼ë¦¬(ë¹„í™œì„±í™”ëœ ì¿¼ë¦¬). -> íŠ¹ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°(GC)ì— ì˜í•´ ì œê±°ëœë‹¤.
  - `inactive`ëœ ì´í›„ì—ë„ `cacheTime` ë™ì•ˆ ìºì‹œëœ ë°ì´í„°ê°€ ìœ ì§€ëœë‹¤. `cacheTime`ì´ ì§€ë‚˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°(GC)ì— ì˜í•´ ì œê±°.

### 2\. option

- **staleTime**: `fresh` ìƒíƒœì—ì„œ `stale` ìƒíƒœë¡œ ì „í™˜ë˜ëŠ” ì‹œê°„ (default: 0)
  - ë³´í†µ ì‰½ê²Œ ë³€í•˜ì§€ ì•ŠëŠ” ì»´í¬ë„ŒíŠ¸ì— í•œí•´ì„œ `staleTime`ì„ ì§€ì •í•œë‹¤.
- **cacheTime**: `inactive` ìƒíƒœì—ì„œ `cachedTime`ë§Œí¼ì˜ ì‹œê°„ì´ ì§€ë‚˜ë©´ `GC(ê°€ë¹„ì§€ ì»¬ë ‰ì…˜/Garbage Collection)`ì— ì˜í•´ ì œê±°ëœë‹¤. (default: 30000 = 5ë¶„) - ì–¸ë§ˆìš´íŠ¸ëœ í›„ ì–´ëŠ ì‹œì ê¹Œì§€ ë©”ëª¨ë¦¬ì— ë°ì´í„°ë¥¼ ì €ì¥í•˜ì—¬ ìºì‹±í•  ê²ƒì¸ì§€ë¥¼ ê²°ì •í•œë‹¤.  
  ![ë¬´ì œ](https://user-images.githubusercontent.com/63364990/162572952-7e36e2f1-c1d2-4a6c-aec5-ad1a27f01930.png)  
  5ì´ˆ ë’¤ ë°ì´í„°ê°€ ì‚¬ë¼ì§ˆ ê²ƒì´ë‹¤.

## refetchingì˜ ì¡°ê±´

1\. ëŸ°íƒ€ì„ ìƒí™©ì— ìƒˆë¡œìš´ ì¸ìŠ¤í„´ìŠ¤ê°€ ë§Œë“¤ì–´ì¡Œì„ ë•Œ  
2\. windowê°€ ë‹¤ì‹œ í¬ì»¤ìŠ¤ê°€ ë˜ì—ˆì„ë•Œ  
3\. ë„¤íŠ¸ì›Œí¬ê°€ ë‹¤ì‹œ ì—°ê²°ë˜ì—ˆì„ ë•Œ  
4\. `refetch interval`(ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸° ê°„ê²©)ì´ ìˆì„ë•Œ: ìš”ì²­ ì‹¤íŒ¨í•œ ì¿¼ë¦¬ëŠ” ì„¤ì •í•œ `refetch interval`ë§Œí¼ `refetch`ë¥¼ í•œë‹¤.

### refetchingì— ê´€í•œ ì§ˆë¬¸ê³¼ ë‹µë“¤

1\. `refetching` ì„ ì™œ í•˜ëŠ”ê°€? â¡ï¸ ì§€ê¸ˆ ê°€ì§€ê³  ìˆëŠ” ì •ë³´ê°€ `fresh` í•˜ì§€ ì•Šê³  `stale`í•˜ê¸° ë•Œë¬¸.  
2\. `refetching` ì¡°ê±´ì„ ë§Œì¡±í•˜ë”ë¼ë„ `fresh`í•˜ë‹¤ë©´ `refetching`í•˜ì§€ ì•ŠëŠ”ê°€? â¡ï¸ Yes.  
3\. `staleTime` ì´ 0ì´ë¼ë©´ `refetching`í•˜ëŠ”ê°€? â¡ï¸ ë°”ë¡œ `stale`ìƒíƒœê°€ ë˜ë¯€ë¡œ `refetching`ì´ ìš”êµ¬ë˜ëŠ” ìƒí™©ì´ ì˜¤ë©´ ë¬´ì¡°ê±´ `refetching`í•œë‹¤.

## ì„¤ì¹˜ & ì´ˆê¸°ì„¸íŒ…

- ì„¤ì¹˜

ìš°ì„  ë¦¬ì•¡íŠ¸ ì•±ì„ ë§Œë“¤ì–´ì¤€ë‹¤.  
`$ npx create-react-app learn-react-query`

**react-query ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜**

```
$ npm install react-query
# or
$ yarn add react-query
```

`App.js`ì— í•„ìš”í•œ í•¨ìˆ˜ë¥¼ importë¥¼ í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ `QueryClientProvider`ì´í•˜ë¡œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°ì‹¼ë‹¤.  
ìºì‹œë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ `QueryClient` ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•œ í›„ `QueryClientProvider`ë¥¼ í†µí•´ ì»´í¬ë„ŒíŠ¸ê°€ `QueryClient` ì¸ìŠ¤í„´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ `queryClient`ë¥¼ ë‚´ë ¤ë³´ë‚´ì¤€ë‹¤.  
![image](https://user-images.githubusercontent.com/63364990/162568763-e21b7efe-2253-460a-a1a4-e1e2798528de.png)

## ê¸°ì¡´ ìš”ì²­ ë°©ì‹ VS react-query ìš”ì²­ ë°©ì‹

- ê¸°ì¡´ ìš”ì²­ ë°©ì‹: `isLoading`ê³¼ `data`ë¥¼ `state`ë¡œ ê°€ì§€ë©° ì„œë²„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ í›„ ìƒíƒœë¥¼ `update`í•œë‹¤.
- react-query: `useQueryí›…`ì„ ì´ìš©í•´ ë°˜í™˜ë°›ì€ `isLoading`ê³¼ `data` ì‚¬ìš©í•œë‹¤.

ì•„ë˜ ì½”ë“œë¡œ ë¹„êµí•´ë³´ì.  
**ê¸°ì¡´ ë°©ì‹**
![ë¬´ì œ](https://user-images.githubusercontent.com/63364990/162569053-9d44861f-2990-4141-b647-ccac187e5115.png)

**react-query ë°©ì‹**
![ë¬´ì œ](https://user-images.githubusercontent.com/63364990/162569062-3617bc54-bc6e-4085-86ca-38bef3407d28.png)

## useQueryë¡œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë²•

- GETìš”ì²­ê³¼ ê°™ì€ CREATì‘ì—…ì„ í• ë•Œ ì‚¬ìš©ë˜ëŠ” í›…ì´ë‹¤.
- ì‚¬ìš©ë²•

```
import { useQuery } from "react-query";
// ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” 3ê°€ì§€ return ê°’ ì™¸ì—ë„ ë” ë§ì€ return ê°’ë“¤ì´ ìˆë‹¤.
const { data, isLoading, error } = useQuery(queryKey, queryFn?, options?);
```

- ğŸ“Œ data: ì„œë²„ìš”ì²­ì— ëŒ€í•œ ë°ì´í„°
- ğŸ“Œ isLoading : ìºì‹œê°€ ì—†ëŠ” ìƒíƒœì—ì„œì˜ ë°ì´í„° ìš”ì²­ ì¤‘ì¸ ìƒíƒœ (true or false)
- ğŸ“Œ error : ì„œë²„ ìš”ì²­ ì‹¤íŒ¨ (object)
- ğŸ“Œ isFetching : ìºì‹œì˜ ìœ ë¬´ì— ìƒê´€ì—†ì´ ë°ì´í„° ìš”ì²­ ì¤‘ì¸ ìƒíƒœ (true or false)
- ğŸ“Œ isError : ì„œë²„ ìš”ì²­ ì‹¤íŒ¨ì— ëŒ€í•œ ìƒíƒœ (true or false)

### QueryKey(queryKey)

- `queryKey`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„° ìºì‹±ì„ ê´€ë¦¬í•œë‹¤.
- ë¬¸ìì—´ ë˜ëŠ” ë°°ì—´ë¡œ ì§€ì •.

```
// ë¬¸ìì—´
useQuery('todos', ...);
// ë°°ì—´
useQuery(['todos'], ...);
```

- ì¿¼ë¦¬ê°€ ë³€ìˆ˜ì— ì˜ì¡´í•˜ëŠ” ê²½ìš°ì—ëŠ” `QueryKey` ì—ë„ í•´ë‹¹ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•´ì£¼ì–´ì•¼í•œë‹¤.  
  ![ë¬´ì œ](https://user-images.githubusercontent.com/63364990/162569631-b1f7d40e-b790-46b4-b009-4be5df03a152.png)

- â—ï¸ ì¿¼ë¦¬ í‚¤ê°€ ë‹¤ë¥´ë©´ í˜¸ì¶œí•˜ëŠ” APIê°€ ê°™ë”ë¼ë„ ìºì‹±ì„ ë³„ë„ë¡œ ê´€ë¦¬í•œë‹¤. â—ï¸
  ![ë¬´ì œ](https://user-images.githubusercontent.com/63364990/162572797-1497873d-2cc7-4aaf-b3c1-d97ce51636a4.png)

### Query Functions(queryFn)

- `useQuery` ì˜ ë‘ë²ˆì§¸ ì¸ìì—ëŠ” `Promise`ë¥¼ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ë¥¼ ë„£ì–´ì£¼ì–´ì•¼í•œë‹¤.  
  ![ë¬´ì œ](https://user-images.githubusercontent.com/63364990/162573469-a7b126e5-1c29-4b2b-9d6c-167d7e7c610c.png)

### Query Options(options)

- `useQuery` ê¸°ëŠ¥ì„ ì œì–´í•œë‹¤. ëª‡ê°œì˜ ì˜µì…˜ë§Œ ì„¤ëª…í•˜ê² ë‹¤.  
  [useQuery-option](https://react-query.tanstack.com/reference/useQuery)

**enabled (boolean)**

- `enabled`ëŠ” ì¿¼ë¦¬ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šê²Œ ì„¤ì •í•˜ëŠ” ì˜µì…˜ì´ë‹¤.
- ì•„ë˜ì˜ ì½”ë“œëŠ” `id`ê°€ ì¡´ì¬í•  ë•Œë§Œ ì¿¼ë¦¬ ìš”ì²­ì„ í•œë‹¤ëŠ” ì˜ë¯¸ì˜ ì½”ë“œì´ë‹¤.  
  ![ë¬´ì œ](https://user-images.githubusercontent.com/63364990/162573575-cfa2388f-3dd6-452b-8006-1d616dd109b5.png)

retry (boolean | number | (failureCount: number, error: TError) => boolean)

- ì‹¤íŒ¨í•œ ì¿¼ë¦¬ë¥¼ ì¬ì‹œë„í•˜ëŠ” ì˜µì…˜ì´ë‹¤.
- number: 3 => ì‹¤íŒ¨í•œ ì¿¼ë¦¬ë¥¼ 3ë²ˆ ì¬ì‹œë„ í•œë‹¤.
- `true`: ì‹¤íŒ¨í•œ ì¿¼ë¦¬ë¥¼ ë¬´í•œ ì¬ì‹œë„í•œë‹¤.
- `false`: ì‹¤íŒ¨í•œ ì¿¼ë¦¬ë¥¼ ì¬ì‹œë„í•˜ì§€ ì•ŠëŠ”ë‹¤.

staleTime (number | Infinity)

- ë°ì´í„°ê°€ `fresh` ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ” ì‹œê°„ì´ë‹¤. í•´ë‹¹ ì‹œê°„ì´ ì§€ë‚˜ë©´ `stale` ìƒíƒœê°€ ëœë‹¤.
- `default`ëŠ” `0`

cacheTime (number | Infinity)

- `inactive` ìƒíƒœì¸ ìºì‹œ ë°ì´í„°ê°€ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ìˆëŠ” ì‹œê°„ì´ë‹¤. ì´ ì‹œê°„ì´ ì§€ë‚˜ë©´ ìºì‹œ ë°ì´í„°ëŠ” ê°€ë¹„ì§€ ì»¬ë ‰í„°(GC)ì— ì˜í•´ ë©”ëª¨ë¦¬ì—ì„œ ì œê±°ëœë‹¤.
- `default`ëŠ” `5ë¶„`

refetchOnMount (boolean | "always")

- ë°ì´í„°ê°€ `stale` ìƒíƒœì¼ ê²½ìš° ë§ˆìš´íŠ¸ ì‹œ ë§ˆë‹¤ `refetch`ë¥¼ ì‹¤í–‰í•˜ëŠ” ì˜µì…˜ì´ë‹¤.
- `always`: ë§ˆìš´íŠ¸ ì‹œ ë§ˆë‹¤ ë§¤ë²ˆ `refetch`ë¥¼ ì‹¤í–‰í•œë‹¤.
- `false`: ë§ˆìš´íŠ¸ ì‹œ `refetch`ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤.
- `true`(default): ë§ˆìš´íŠ¸ ì‹œ ë§ˆë‹¤ refetchë¥¼ ì‹¤í–‰í•œë‹¤.

## ì°¸ê³ 

[React-Query Docs](https://react-query.tanstack.com/)  
[react-queryë¥¼ ì´í•´í•˜ëŠ” ëª‡ê°€ì§€ ì§€ì‹ê³¼ ì§ˆë¬¸ë“¤](https://darrengwon.tistory.com/1517)  
[react-query-velog](https://velog.io/@jkl1545/React-Query)  
[React-Query ì‚´í´ë³´ê¸°](https://maxkim-j.github.io/posts/react-query-preview)
[[React Query] ë¦¬ì•¡íŠ¸ ì¿¼ë¦¬ ì‹œì‘í•˜ê¸° (useQuery)](https://velog.io/@kimhyo_0218/React-Query-%EB%A6%AC%EC%95%A1%ED%8A%B8-%EC%BF%BC%EB%A6%AC-%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0-useQuery)
